<html><head><link rel='stylesheet' href='style.css' type='text/css'><link rel='stylesheet' href='default.css' type='text/css'><meta http-equiv='Content-Type' content='text/html; charset=utf-8'><title>Testing</title></head><body>
<p class="head">Section 12 of the Rust language tutorial.<br><a href="task.html">« Section 11</a> | <a href="index.html">Index</a></p><div id="content"><h1>Testing</h1>

<p>The Rust language has a facility for testing built into the language.
Tests can be interspersed with other code, and annotated with the
<code>#[test]</code> attribute.</p>

<pre class="cm-s-default"><span class="cm-keyword">use</span> <span class="cm-variable">std</span>;</pre>

<pre class="cm-s-default"><span class="cm-keyword">fn</span> <span class="cm-def">twice</span>(<span class="cm-def">x</span>: <span class="cm-keyword">int</span>) -&gt; <span class="cm-keyword">int</span> { <span class="cm-variable">x</span> + <span class="cm-variable">x</span> }</pre>

<pre class="cm-s-default">#[<span class="cm-variable">test</span>]
<span class="cm-keyword">fn</span> <span class="cm-def">test_twice</span>() {
    <span class="cm-keyword">let</span> <span class="cm-def">i</span> = -<span class="cm-number">100</span>;
    <span class="cm-keyword">while</span> <span class="cm-variable">i</span> &lt; <span class="cm-number">100</span> {
        <span class="cm-keyword">assert</span> <span class="cm-variable">twice</span>(<span class="cm-variable">i</span>) == <span class="cm-number">2</span> * <span class="cm-variable">i</span>;
        <span class="cm-variable">i</span> += <span class="cm-number">1</span>;
    }
}</pre>

<p>When you compile the program normally, the <code>test_twice</code> function will
not be used. To actually run the tests, compile with the <code>--test</code>
flag:</p>

<pre class="cm-s-default">&gt; <span class="cm-variable">rustc</span> --<span class="cm-variable">lib</span> <span class="cm-variable">twice</span>.<span class="cm-variable">rs</span>
&gt; .<span class="cm-variable">/twice</span>
<span class="cm-variable">running</span> <span class="cm-number">1</span> <span class="cm-variable">tests</span>
<span class="cm-variable">test</span> <span class="cm-variable">test_twice</span> ... <span class="cm-variable">ok</span>
<span class="cm-variable">result</span>: <span class="cm-variable">ok</span>. <span class="cm-variable">1</span> <span class="cm-variable">passed</span>; <span class="cm-number">0</span> <span class="cm-variable">failed</span>; <span class="cm-number">0</span> <span class="cm-variable">ignored</span></pre>

<p>Or, if we change the file to fail, for example by replacing <code>x + x</code>
with <code>x + 1</code>:</p>

<pre class="cm-s-default"><span class="cm-variable">running</span> <span class="cm-number">1</span> <span class="cm-variable">tests</span>
<span class="cm-variable">test</span> <span class="cm-variable">test_twice</span> ... <span class="cm-variable">FAILED</span>
<span class="cm-variable">failures</span>:
    <span class="cm-variable">test_twice</span>
<span class="cm-variable">result</span>: <span class="cm-variable">FAILED</span>. <span class="cm-variable">0</span> <span class="cm-variable">passed</span>; <span class="cm-number">1</span> <span class="cm-variable">failed</span>; <span class="cm-number">0</span> <span class="cm-variable">ignored</span></pre>

<p>You can pass a command-line argument to a program compiled with
<code>--test</code> to run only the tests whose name matches the given string. If
we had, for example, test functions <code>test_twice</code>, <code>test_once_1</code>, and
<code>test_once_2</code>, running our program with <code>./twice test_once</code> would run
the latter two, and running it with <code>./twice test_once_2</code> would run
only the last.</p>

<p>To indicate that a test is supposed to fail instead of pass, you can
give it a <code>#[should_fail]</code> attribute.</p>

<pre class="cm-s-default"><span class="cm-keyword">use</span> <span class="cm-variable">std</span>;</pre>

<pre class="cm-s-default"><span class="cm-keyword">fn</span> <span class="cm-def">divide</span>(<span class="cm-def">a</span>: <span class="cm-keyword">float</span>, <span class="cm-def">b</span>: <span class="cm-keyword">float</span>) -&gt; <span class="cm-keyword">float</span> {
    <span class="cm-keyword">if</span> <span class="cm-variable">b</span> == <span class="cm-number">0</span><span class="cm-variable">f</span> { <span class="cm-keyword">fail</span>; }
    <span class="cm-variable">a</span> <span class="cm-variable">/</span> <span class="cm-variable">b</span>
}</pre>

<pre class="cm-s-default">#[<span class="cm-variable">test</span>]
#[<span class="cm-variable">should_fail</span>]
<span class="cm-keyword">fn</span> <span class="cm-def">divide_by_zero</span>() { <span class="cm-variable">divide</span>(<span class="cm-number">1</span><span class="cm-variable">f</span>, <span class="cm-number">0</span><span class="cm-variable">f</span>); }</pre>

<p>To disable a test completely, add an <code>#[ignore]</code> attribute. Running a
test runner (the program compiled with <code>--test</code>) with an <code>--ignored</code>
command-line flag will cause it to also run the tests labelled as
ignored.</p>

<p>A program compiled as a test runner will have the configuration flag
<code>test</code> defined, so that you can add code that won&#39;t be included in a
normal compile with the <code>#[cfg(test)]</code> attribute (see <a href="syntax.md#conditional)">conditional
compilation</a>.</p></div><p class="head">Section 12 of the Rust language tutorial.<br><a href="task.html">« Section 11</a> | <a href="index.html">Index</a></p><p class='head'>Created October 1, 2011, last modified on October 4, 2011</p></body></html>